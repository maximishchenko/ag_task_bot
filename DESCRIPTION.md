# Telegram bot для управления списком оперативных заявок на текущий день

## Назначение

Telegram bot для управления списком оперативных заявок (далее - "Приложение") разработан с целью снижения трудозатрат оперативных дежурных, связанных с формированием списка оперативных заявок на текущую дату. 

При разработке функционала учтены следующие потребности рабочих процессов
* формиррование списка оперативных заявок на текущую дату;
* доведение состава заявок до непосредственных исполнителей; 
* снижение количества допускаемых ошибок, вследствии возможных упущений при ручном формировании списка;
* получение перечня заявок непосредственным исполнителем по запросу;
* предоставление возможности самостоятельного переноса даты исполнения заявки непосредственным исполнителем (в разработке);
* получение статистики обработки заявок (в разработке)

## Описание

### Приложение реализует следующий алгоритм работы:

* Запрашивает список оперативных заявок из КПО Кобра. Заявка считается оперативной, если ее заголовок начинается с префикса *** (указывается в поле "Заявка" КПО Кобра).
* Производит сортировку заявок, полученных из КПО Кобра по исполнителю (ответственное лицо, указанное в поле "Техник" КПО Кобра).
* Производит отбор заявок, дата исполнения которых (поле "Назначенное время" в карточке заявки КПО Кобра) не превосходит текущую дату.
* Формирует сводный отчет в 2-х представлениях: сводная таблица в формате Microsoft Excel и текстовое сообщение, - содержащий данные оперативных заявок на текущую дату.
* Направляет сводный отчет в группу Telegram (на текущий момент ИТС3.0, но может быть скорректирована при необходимости по запросу) и персональные уведомления исполнителям (при условии, что исполнитель прошел процедуру регистрации).

### Приложение реализует следующие функции:

* Формирование отчета о составе оперативных заявок на текущую дату по расписанию (на текущий момент - ежедневно в 08:30, время может быть скорректировано при необходимости по запросу);
* Направление указанного отчета в группу и персональное уведомление исполнителей, прошедших процедуру регистрации;
* Регистрация - единовременная процедура для получения персональных уведомлений, получение списка заявок по требованию, переноса даты исполнения заявки (в разработке);
* Формирование статистики эффективности исполнения оперативных заявок (в разработке).

## Регистрация

После прохождения процедуры регистрации технику становятся доступны персональные уведомления с составом заявок на текущую дату и получение актуального списка заявок по запросу.
Для подтверждения регистрации необходимо передать данные для авторизации в приложении "Мобильный техник" КПО Кобра.

Для запуска процесса регистрации необходимо перейти в приложение Telegram, средствами поиска найти бота Alfa Group (прямая ссылка - https://t.me/alfa_group_notify_bot) и нажать кнопку "Старт" (в случае первого взаимодействияс ботом, в остальных случаях кнопка "Старт" не будет отображаться). После нажатия кнопки "Старт" бот пришлет сообщение с кратким описанием взаимодействия. Далее необходимо передать боту команду регистрации (/signup), ссылка на которую указана в сообщении бота или нажать кнопку "Меню" и выбрать пункт "Регистрация". В случае, если пользователь не зарегистрирован - будет запрошено имя пользователя приложения "Мобильный техник" КПО Кобра, которое нужно передать боту обычным текстовым сообщением. Затем бот запросит пароль от приложения "Мобильный техник", который также нужно будет передать обычным текстовым сообщением. В случае, если данные приложения "Мобильный техник" корректны - пользователь будет сохранен в базе данных приложения и для пользователя Telegram будет указана связь с техником, зарегистрированным в КПО Кобра. Если данные переданы ошибочно или некорректно - пользьватель не будет сохранен в базе данных КПО Кобра и процедуру регистрации необходимо будет инициировать повторно. В случае, если пользователь предпримет попытку повторной регистрации - приложение сообщит о том, что пользователь уже зарегистрирован.

## Формирование списка заявок

Приложение отправляет отчеты со списком заявок ежедневно, по расписнию. На текущий момент установлено время отправки - 08:30. В случае если отсутствуют заявки на текущую дату в группу ИТС3.0 будет направлено соответствующее уведомление.

После отправки отчета персональный список заявок будет направлен каждому зарегистрированному исполнителю (технику)

Формирование и направление списка заявок в группу возможно запустить вручную, если перейти в группу ИТС 3.0, нажать кнопку со списком команд бота ("/") и нажать на кнопку "Генерация списка заявок /tasks"

Аналогичная функция доступна также в прямом диалоге с ботом, за тем исключением, что при запуске в группе будет сформирован общий список, в диалоге с ботом - персональный. Нужно учитывать, что если незарегистрированный пользователь запросит персональный список заявок в прямом диалоге с ботом - бот не пришлет список заявок, т.к. однозначно идентифицировать инициатора запроса не представляется возможным.